import{a as Ae,e as G,f as ue,Q as W}from"./scroll.a8da4cf4.js";import{q as ce,w as Ie,h as De,f as Re,i as de,m as ve,j as Qe,b as Le,k as He}from"./firebase.b163514c.js";import{V as Ve,W as Z,A as f,Z as je,n as z,B as X,m as Q,Q as U,o as Y,p as P,a0 as R,x,w as B,a1 as E,a2 as J,y as fe,H as he,I as Fe,ac as I,a9 as Ne,au as Ue,K as j,av as ee,R as me,N as te,O as re,M as ae,t as C,ak as Xe,Y as Ye,am as qe,an as Ce,P as Ke,v as ne,q as F,ae as Ge,a3 as We,aw as Ze,a4 as Je,z as xe,a5 as et,aa as tt,aj as at,ax as ot,at as lt}from"./index.b7c3ad49.js";import{c as rt,_ as ke,a as nt,u as it,b as st}from"./room.b814678f.js";import{h as we,e as ut,f as ct,s as dt,c as N,g as vt,R as ft,b as ht,Q as Be,r as mt}from"./QBtn.1106fff4.js";import{a as bt,Q as gt,b as pt}from"./QInput.7956ab7a.js";import{Q as yt}from"./QCard.1be5af88.js";import{a as Pe,b as Me}from"./auth.3820e33c.js";import{Q as be,a as St}from"./QScrollObserver.2a6200a8.js";const _t={position:{type:String,default:"bottom-right",validator:e=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(e)},offset:{type:Array,validator:e=>e.length===2},expand:Boolean};function zt(){const{props:e,proxy:{$q:r}}=X(),n=Ve(je,Z);if(n===Z)return console.error("QPageSticky needs to be child of QLayout"),Z;const b=f(()=>{const h=e.position;return{top:h.indexOf("top")!==-1,right:h.indexOf("right")!==-1,bottom:h.indexOf("bottom")!==-1,left:h.indexOf("left")!==-1,vertical:h==="top"||h==="bottom",horizontal:h==="left"||h==="right"}}),t=f(()=>n.header.offset),o=f(()=>n.right.offset),l=f(()=>n.footer.offset),a=f(()=>n.left.offset),s=f(()=>{let h=0,g=0;const c=b.value,p=r.lang.rtl===!0?-1:1;c.top===!0&&t.value!==0?g=`${t.value}px`:c.bottom===!0&&l.value!==0&&(g=`${-l.value}px`),c.left===!0&&a.value!==0?h=`${p*a.value}px`:c.right===!0&&o.value!==0&&(h=`${-p*o.value}px`);const m={transform:`translate(${h}, ${g})`};return e.offset&&(m.margin=`${e.offset[1]}px ${e.offset[0]}px`),c.vertical===!0?(a.value!==0&&(m[r.lang.rtl===!0?"right":"left"]=`${a.value}px`),o.value!==0&&(m[r.lang.rtl===!0?"left":"right"]=`${o.value}px`)):c.horizontal===!0&&(t.value!==0&&(m.top=`${t.value}px`),l.value!==0&&(m.bottom=`${l.value}px`)),m}),u=f(()=>`q-page-sticky row flex-center fixed-${e.position} q-page-sticky--${e.expand===!0?"expand":"shrink"}`);function y(h){const g=we(h.default);return z("div",{class:u.value,style:s.value},e.expand===!0?g:[z("div",g)])}return{$layout:n,getStickyContent:y}}var qt=Q({name:"QPageSticky",props:_t,setup(e,{slots:r}){const{getStickyContent:n}=zt();return()=>n(r)}});const Ct={xs:8,sm:10,md:14,lg:20,xl:24};var xt=Q({name:"QChip",props:{...Pe,...ut,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:r,emit:n}){const{proxy:{$q:b}}=X(),t=Me(e,b),o=ct(e,Ct),l=f(()=>e.selected===!0||e.icon!==void 0),a=f(()=>e.selected===!0?e.iconSelected||b.iconSet.chip.selected:e.icon),s=f(()=>e.iconRemove||b.iconSet.chip.remove),u=f(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),y=f(()=>{const d=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(d?` text-${d} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(u.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(t.value===!0?" q-chip--dark q-dark":"")}),h=f(()=>{const d=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},S={...d,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||b.lang.label.remove};return{chip:d,remove:S}});function g(d){d.keyCode===13&&c(d)}function c(d){e.disable||(n("update:selected",!e.selected),n("click",d))}function p(d){(d.keyCode===void 0||d.keyCode===13)&&(U(d),e.disable===!1&&(n("update:modelValue",!1),n("remove")))}function m(){const d=[];u.value===!0&&d.push(z("div",{class:"q-focus-helper"})),l.value===!0&&d.push(z(N,{class:"q-chip__icon q-chip__icon--left",name:a.value}));const S=e.label!==void 0?[z("div",{class:"ellipsis"},[e.label])]:void 0;return d.push(z("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},vt(r.default,S))),e.iconRight&&d.push(z(N,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&d.push(z(N,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:s.value,...h.value.remove,onClick:p,onKeyup:p})),d}return()=>{if(e.modelValue===!1)return;const d={class:y.value,style:o.value};return u.value===!0&&Object.assign(d,h.value.chip,{onClick:c,onKeyup:g}),dt("div",d,m(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[ft,e.ripple]])}}});const kt={class:"row items-center no-wrap q-pa-sm"},wt=["src"],Bt={class:"column"},Pt={class:"text-caption"},Mt={class:"text-body1"},Ot=Y({__name:"ChatMessage",props:{data:{}},setup(e){const r=e,n=f(()=>{var o;return((o=r.data)==null?void 0:o.message)||""}),b=f(()=>{var o,l;return((l=(o=r.data)==null?void 0:o.author)==null?void 0:l.photoURL)||""}),t=f(()=>{var o,l;return((l=(o=r.data)==null?void 0:o.author)==null?void 0:l.displayName)||"Unknown User"});return(o,l)=>(P(),R("div",kt,[x(Ae,{size:"32px",class:"q-mr-md"},{default:B(()=>[E("img",{src:b.value},null,8,wt)]),_:1}),E("div",Bt,[E("span",Pt,J(t.value),1),E("span",Mt,[fe(J(n.value)+" ",1),x(xt,{dense:"",size:"sm",class:"q-ml-sm text-grey-7 self-center"},{default:B(()=>{var a,s,u,y,h,g;return[fe(J(((s=(a=r.data)==null?void 0:a.timestamp)==null?void 0:s.toDate().toLocaleDateString())===new Date().toLocaleDateString()?(y=(u=r.data)==null?void 0:u.timestamp)==null?void 0:y.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):(g=(h=r.data)==null?void 0:h.timestamp)==null?void 0:g.toDate().toLocaleString([],{hour:"2-digit",minute:"2-digit"})),1)]}),_:1})])])]))}});var $t=Q({props:["store","barStyle","verticalBarStyle","horizontalBarStyle"],setup(e){return()=>[z("div",{class:e.store.scroll.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:e.store.onVerticalMousedown}),z("div",{class:e.store.scroll.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:e.store.onHorizontalMousedown}),he(z("div",{ref:e.store.scroll.vertical.ref,class:e.store.scroll.vertical.thumbClass.value,style:e.store.scroll.vertical.style.value,"aria-hidden":"true"}),e.store.thumbVertDir),he(z("div",{ref:e.store.scroll.horizontal.ref,class:e.store.scroll.horizontal.thumbClass.value,style:e.store.scroll.horizontal.style.value,"aria-hidden":"true"}),e.store.thumbHorizDir)]}});const ie={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},Et=Object.keys(ie);ie.all=!0;function ge(e){const r={};for(const n of Et)e[n]===!0&&(r[n]=!0);return Object.keys(r).length===0?ie:(r.horizontal===!0?r.left=r.right=!0:r.left===!0&&r.right===!0&&(r.horizontal=!0),r.vertical===!0?r.up=r.down=!0:r.up===!0&&r.down===!0&&(r.vertical=!0),r.horizontal===!0&&r.vertical===!0&&(r.all=!0),r)}const Tt=["INPUT","TEXTAREA"];function pe(e,r){return r.event===void 0&&e.target!==void 0&&e.target.draggable!==!0&&typeof r.handler=="function"&&Tt.includes(e.target.nodeName.toUpperCase())===!1&&(e.qClonedBy===void 0||e.qClonedBy.indexOf(r.uid)===-1)}function oe(e,r,n){const b=re(e);let t,o=b.left-r.event.x,l=b.top-r.event.y,a=Math.abs(o),s=Math.abs(l);const u=r.direction;u.horizontal===!0&&u.vertical!==!0?t=o<0?"left":"right":u.horizontal!==!0&&u.vertical===!0?t=l<0?"up":"down":u.up===!0&&l<0?(t="up",a>s&&(u.left===!0&&o<0?t="left":u.right===!0&&o>0&&(t="right"))):u.down===!0&&l>0?(t="down",a>s&&(u.left===!0&&o<0?t="left":u.right===!0&&o>0&&(t="right"))):u.left===!0&&o<0?(t="left",a<s&&(u.up===!0&&l<0?t="up":u.down===!0&&l>0&&(t="down"))):u.right===!0&&o>0&&(t="right",a<s&&(u.up===!0&&l<0?t="up":u.down===!0&&l>0&&(t="down")));let y=!1;if(t===void 0&&n===!1){if(r.event.isFirst===!0||r.event.lastDir===void 0)return{};t=r.event.lastDir,y=!0,t==="left"||t==="right"?(b.left-=o,a=0,o=0):(b.top-=l,s=0,l=0)}return{synthetic:y,payload:{evt:e,touch:r.event.mouse!==!0,mouse:r.event.mouse===!0,position:b,direction:t,isFirst:r.event.isFirst,isFinal:n===!0,duration:Date.now()-r.event.time,distance:{x:a,y:s},offset:{x:o,y:l},delta:{x:b.left-r.event.lastX,y:b.top-r.event.lastY}}}}let At=0;var ye=Fe({name:"touch-pan",beforeMount(e,{value:r,modifiers:n}){if(n.mouse!==!0&&I.has.touch!==!0)return;function b(o,l){n.mouse===!0&&l===!0?U(o):(n.stop===!0&&te(o),n.prevent===!0&&me(o))}const t={uid:"qvtp_"+At++,handler:r,modifiers:n,direction:ge(n),noop:Ne,mouseStart(o){pe(o,t)&&Ue(o)&&(j(t,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),t.start(o,!0))},touchStart(o){if(pe(o,t)){const l=o.target;j(t,"temp",[[l,"touchmove","move","notPassiveCapture"],[l,"touchcancel","end","passiveCapture"],[l,"touchend","end","passiveCapture"]]),t.start(o)}},start(o,l){if(I.is.firefox===!0&&ee(e,!0),t.lastEvt=o,l===!0||n.stop===!0){if(t.direction.all!==!0&&(l!==!0||t.modifiers.mouseAllDir!==!0&&t.modifiers.mousealldir!==!0)){const u=o.type.indexOf("mouse")!==-1?new MouseEvent(o.type,o):new TouchEvent(o.type,o);o.defaultPrevented===!0&&me(u),o.cancelBubble===!0&&te(u),Object.assign(u,{qKeyEvent:o.qKeyEvent,qClickOutside:o.qClickOutside,qAnchorHandled:o.qAnchorHandled,qClonedBy:o.qClonedBy===void 0?[t.uid]:o.qClonedBy.concat(t.uid)}),t.initialEvent={target:o.target,event:u}}te(o)}const{left:a,top:s}=re(o);t.event={x:a,y:s,time:Date.now(),mouse:l===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:a,lastY:s}},move(o){if(t.event===void 0)return;const l=re(o),a=l.left-t.event.x,s=l.top-t.event.y;if(a===0&&s===0)return;t.lastEvt=o;const u=t.event.mouse===!0,y=()=>{b(o,u);let c;n.preserveCursor!==!0&&n.preservecursor!==!0&&(c=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),u===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),rt(),t.styleCleanup=p=>{if(t.styleCleanup=void 0,c!==void 0&&(document.documentElement.style.cursor=c),document.body.classList.remove("non-selectable"),u===!0){const m=()=>{document.body.classList.remove("no-pointer-events--children")};p!==void 0?setTimeout(()=>{m(),p()},50):m()}else p!==void 0&&p()}};if(t.event.detected===!0){t.event.isFirst!==!0&&b(o,t.event.mouse);const{payload:c,synthetic:p}=oe(o,t,!1);c!==void 0&&(t.handler(c)===!1?t.end(o):(t.styleCleanup===void 0&&t.event.isFirst===!0&&y(),t.event.lastX=c.position.left,t.event.lastY=c.position.top,t.event.lastDir=p===!0?void 0:c.direction,t.event.isFirst=!1));return}if(t.direction.all===!0||u===!0&&(t.modifiers.mouseAllDir===!0||t.modifiers.mousealldir===!0)){y(),t.event.detected=!0,t.move(o);return}const h=Math.abs(a),g=Math.abs(s);h!==g&&(t.direction.horizontal===!0&&h>g||t.direction.vertical===!0&&h<g||t.direction.up===!0&&h<g&&s<0||t.direction.down===!0&&h<g&&s>0||t.direction.left===!0&&h>g&&a<0||t.direction.right===!0&&h>g&&a>0?(t.event.detected=!0,t.move(o)):t.end(o,!0))},end(o,l){if(t.event!==void 0){if(ae(t,"temp"),I.is.firefox===!0&&ee(e,!1),l===!0)t.styleCleanup!==void 0&&t.styleCleanup(),t.event.detected!==!0&&t.initialEvent!==void 0&&t.initialEvent.target.dispatchEvent(t.initialEvent.event);else if(t.event.detected===!0){t.event.isFirst===!0&&t.handler(oe(o===void 0?t.lastEvt:o,t).payload);const{payload:a}=oe(o===void 0?t.lastEvt:o,t,!0),s=()=>{t.handler(a)};t.styleCleanup!==void 0?t.styleCleanup(s):s()}t.event=void 0,t.initialEvent=void 0,t.lastEvt=void 0}}};if(e.__qtouchpan=t,n.mouse===!0){const o=n.mouseCapture===!0||n.mousecapture===!0?"Capture":"";j(t,"main",[[e,"mousedown","mouseStart",`passive${o}`]])}I.has.touch===!0&&j(t,"main",[[e,"touchstart","touchStart",`passive${n.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,r){const n=e.__qtouchpan;n!==void 0&&(r.oldValue!==r.value&&(typeof value!="function"&&n.end(),n.handler=r.value),n.direction=ge(r.modifiers))},beforeUnmount(e){const r=e.__qtouchpan;r!==void 0&&(r.event!==void 0&&r.end(),ae(r,"main"),ae(r,"temp"),I.is.firefox===!0&&ee(e,!1),r.styleCleanup!==void 0&&r.styleCleanup(),delete e.__qtouchpan)}});function D(e,r,n){return n<=r?r:Math.min(n,Math.max(r,e))}const Se=["vertical","horizontal"],le={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},_e={prevent:!0,mouse:!0,mouseAllDir:!0},ze=e=>e>=250?50:Math.ceil(e/5);var It=Q({name:"QScrollArea",props:{...Pe,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],verticalOffset:{type:Array,default:[0,0]},horizontalOffset:{type:Array,default:[0,0]},contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:r,emit:n}){const b=C(!1),t=C(!1),o=C(!1),l={vertical:C(0),horizontal:C(0)},a={vertical:{ref:C(null),position:C(0),size:C(0)},horizontal:{ref:C(null),position:C(0),size:C(0)}},{proxy:s}=X(),u=Me(e,s.$q);let y=null,h;const g=C(null),c=f(()=>"q-scrollarea"+(u.value===!0?" q-scrollarea--dark":""));Object.assign(l,{verticalInner:f(()=>l.vertical.value-e.verticalOffset[0]-e.verticalOffset[1]),horizontalInner:f(()=>l.horizontal.value-e.horizontalOffset[0]-e.horizontalOffset[1])}),a.vertical.percentage=f(()=>{const i=a.vertical.size.value-l.vertical.value;if(i<=0)return 0;const v=D(a.vertical.position.value/i,0,1);return Math.round(v*1e4)/1e4}),a.vertical.thumbHidden=f(()=>(e.visible===null?o.value:e.visible)!==!0&&b.value===!1&&t.value===!1||a.vertical.size.value<=l.vertical.value+1),a.vertical.thumbStart=f(()=>e.verticalOffset[0]+a.vertical.percentage.value*(l.verticalInner.value-a.vertical.thumbSize.value)),a.vertical.thumbSize=f(()=>Math.round(D(l.verticalInner.value*l.verticalInner.value/a.vertical.size.value,ze(l.verticalInner.value),l.verticalInner.value))),a.vertical.style=f(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${a.vertical.thumbStart.value}px`,height:`${a.vertical.thumbSize.value}px`,right:`${e.horizontalOffset[1]}px`})),a.vertical.thumbClass=f(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.vertical.barClass=f(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),a.horizontal.percentage=f(()=>{const i=a.horizontal.size.value-l.horizontal.value;if(i<=0)return 0;const v=D(Math.abs(a.horizontal.position.value)/i,0,1);return Math.round(v*1e4)/1e4}),a.horizontal.thumbHidden=f(()=>(e.visible===null?o.value:e.visible)!==!0&&b.value===!1&&t.value===!1||a.horizontal.size.value<=l.horizontal.value+1),a.horizontal.thumbStart=f(()=>e.horizontalOffset[0]+a.horizontal.percentage.value*(l.horizontalInner.value-a.horizontal.thumbSize.value)),a.horizontal.thumbSize=f(()=>Math.round(D(l.horizontalInner.value*l.horizontalInner.value/a.horizontal.size.value,ze(l.horizontalInner.value),l.horizontalInner.value))),a.horizontal.style=f(()=>({...e.thumbStyle,...e.horizontalThumbStyle,[s.$q.lang.rtl===!0?"right":"left"]:`${a.horizontal.thumbStart.value}px`,width:`${a.horizontal.thumbSize.value}px`,bottom:`${e.verticalOffset[1]}px`})),a.horizontal.thumbClass=f(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.horizontal.barClass=f(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const p=f(()=>a.vertical.thumbHidden.value===!0&&a.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle);function m(){const i={};return Se.forEach(v=>{const _=a[v];Object.assign(i,{[v+"Position"]:_.position.value,[v+"Percentage"]:_.percentage.value,[v+"Size"]:_.size.value,[v+"ContainerSize"]:l[v].value,[v+"ContainerInnerSize"]:l[v+"Inner"].value})}),i}const d=Xe(()=>{const i=m();i.ref=s,n("scroll",i)},0);function S(i,v,_){if(Se.includes(i)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(i==="vertical"?ue:G)(g.value,v,_)}function L({height:i,width:v}){let _=!1;l.vertical.value!==i&&(l.vertical.value=i,_=!0),l.horizontal.value!==v&&(l.horizontal.value=v,_=!0),_===!0&&M()}function q({position:i}){let v=!1;a.vertical.position.value!==i.top&&(a.vertical.position.value=i.top,v=!0),a.horizontal.position.value!==i.left&&(a.horizontal.position.value=i.left,v=!0),v===!0&&M()}function k({height:i,width:v}){a.horizontal.size.value!==v&&(a.horizontal.size.value=v,M()),a.vertical.size.value!==i&&(a.vertical.size.value=i,M())}function w(i,v){const _=a[v];if(i.isFirst===!0){if(_.thumbHidden.value===!0)return;h=_.position.value,t.value=!0}else if(t.value!==!0)return;i.isFinal===!0&&(t.value=!1);const $=le[v],A=(_.size.value-l[v].value)/(l[v+"Inner"].value-_.thumbSize.value),V=i.distance[$.dist],K=h+(i.direction===$.dir?1:-1)*V*A;se(K,v)}function T(i,v){const _=a[v];if(_.thumbHidden.value!==!0){const $=v==="vertical"?e.verticalOffset[0]:e.horizontalOffset[0],A=i[le[v].offset]-$,V=_.thumbStart.value-$;if(A<V||A>V+_.thumbSize.value){const K=A-_.thumbSize.value/2,Te=D(K/(l[v+"Inner"].value-_.thumbSize.value),0,1);se(Te*Math.max(0,_.size.value-l[v].value),v)}_.ref.value!==null&&_.ref.value.dispatchEvent(new MouseEvent(i.type,i))}}function M(){b.value=!0,y!==null&&clearTimeout(y),y=setTimeout(()=>{y=null,b.value=!1},e.delay),e.onScroll!==void 0&&d()}function se(i,v){g.value[le[v].scroll]=i}let O=null;function Oe(){O!==null&&clearTimeout(O),O=setTimeout(()=>{O=null,o.value=!0},s.$q.platform.is.ios?50:0)}function $e(){O!==null&&(clearTimeout(O),O=null),o.value=!1}let H=null;Ye(()=>s.$q.lang.rtl,i=>{g.value!==null&&G(g.value,Math.abs(a.horizontal.position.value)*(i===!0?-1:1))}),qe(()=>{H={top:a.vertical.position.value,left:a.horizontal.position.value}}),Ce(()=>{if(H===null)return;const i=g.value;i!==null&&(G(i,H.left),ue(i,H.top))}),Ke(d.cancel),Object.assign(s,{getScrollTarget:()=>g.value,getScroll:m,getScrollPosition:()=>({top:a.vertical.position.value,left:a.horizontal.position.value}),getScrollPercentage:()=>({top:a.vertical.percentage.value,left:a.horizontal.percentage.value}),setScrollPosition:S,setScrollPercentage(i,v,_){S(i,v*(a[i].size.value-l[i].value)*(i==="horizontal"&&s.$q.lang.rtl===!0?-1:1),_)}});const Ee={scroll:a,thumbVertDir:[[ye,i=>{w(i,"vertical")},void 0,{vertical:!0,..._e}]],thumbHorizDir:[[ye,i=>{w(i,"horizontal")},void 0,{horizontal:!0,..._e}]],onVerticalMousedown(i){T(i,"vertical")},onHorizontalMousedown(i){T(i,"horizontal")}};return()=>z("div",{class:c.value,onMouseenter:Oe,onMouseleave:$e},[z("div",{ref:g,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[z("div",{class:"q-scrollarea__content absolute",style:p.value},ht(r.default,[z(be,{debounce:0,onResize:k})])),z(St,{axis:"both",onScroll:q})]),z(be,{debounce:0,onResize:L}),z($t,{store:Ee,barStyle:e.barStyle,verticalBarStyle:e.verticalBarStyle,horizontalBarStyle:e.horizontalBarStyle})])}});const Dt={key:0,class:"text-center q-pa-md text-grey"},Rt=Y({__name:"ChatMessageList",props:{messages:{}},setup(e){const r=e,n=C(null),b=f(()=>{var s;return(s=n.value)==null?void 0:s.getScrollTarget().scrollHeight}),t=f(()=>{var s;return(s=n.value)==null?void 0:s.getScrollTarget().clientHeight}),o=f(()=>{var s;return(s=n.value)==null?void 0:s.getScrollPercentage().top}),l=f(()=>b.value>=t.value&&o.value!=1),a=()=>{var s;(s=n.value)==null||s.setScrollPercentage("vertical",1,300)};return ne(()=>{var s;(s=n.value)==null||s.setScrollPercentage("vertical",1,300),setTimeout(()=>{},300),a()}),(s,u)=>(P(),F(yt,{flat:"",bordered:"",class:"messages-container rounded-borders"},{default:B(()=>[x(xe(It),{ref_key:"scrollAreaRef",ref:n,style:{height:"inherit"}},{default:B(()=>[x(bt,{dense:"",class:"full-height",ref:"list"},{default:B(()=>[r.messages.length===0?(P(),R("div",Dt,[x(N,{name:"chat",size:"48px",color:"grey-4"}),u[0]||(u[0]=E("div",{class:"text-h6 q-mt-sm"},"No messages yet",-1)),u[1]||(u[1]=E("div",{class:"text-caption"}," Be the first to start the conversation! ",-1))])):(P(!0),R(We,{key:1},Ge(r.messages,y=>(P(),F(gt,{key:y.id},{default:B(()=>[x(Ot,{data:y.data},null,8,["data"])]),_:2},1024))),128))]),_:1},512),x(Ze,{name:"toBottomBtn"},{default:B(()=>[l.value?(P(),F(qt,{key:0,position:"bottom",class:"q-mb-lg"},{default:B(()=>[x(Be,{color:"pink-5",onClick:a,icon:"arrow_downward",round:"",dense:"",unelevated:""})]),_:1})):Je("",!0)]),_:1})]),_:1},512)]),_:1}))}});var Qt=ke(Rt,[["__scopeId","data-v-81412da6"]]),Lt=Q({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:r,emit:n}){const b=X(),t=C(null);let o=0;const l=[];function a(c){const p=typeof c=="boolean"?c:e.noErrorFocus!==!0,m=++o,d=(q,k)=>{n(`validation${q===!0?"Success":"Error"}`,k)},S=q=>{const k=q.validate();return typeof k.then=="function"?k.then(w=>({valid:w,comp:q}),w=>({valid:!1,comp:q,err:w})):Promise.resolve({valid:k,comp:q})};return(e.greedy===!0?Promise.all(l.map(S)).then(q=>q.filter(k=>k.valid!==!0)):l.reduce((q,k)=>q.then(()=>S(k).then(w=>{if(w.valid===!1)return Promise.reject(w)})),Promise.resolve()).catch(q=>[q])).then(q=>{if(q===void 0||q.length===0)return m===o&&d(!0),!0;if(m===o){const{comp:k,err:w}=q[0];if(w!==void 0&&console.error(w),d(!1,k),p===!0){const T=q.find(({comp:M})=>typeof M.focus=="function"&&mt(M.$)===!1);T!==void 0&&T.comp.focus()}}return!1})}function s(){o++,l.forEach(c=>{typeof c.resetValidation=="function"&&c.resetValidation()})}function u(c){c!==void 0&&U(c);const p=o+1;a().then(m=>{p===o&&m===!0&&(e.onSubmit!==void 0?n("submit",c):c!==void 0&&c.target!==void 0&&typeof c.target.submit=="function"&&c.target.submit())})}function y(c){c!==void 0&&U(c),n("reset"),tt(()=>{s(),e.autofocus===!0&&e.noResetFocus!==!0&&h()})}function h(){nt(()=>{if(t.value===null)return;const c=t.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(t.value.querySelectorAll("[tabindex]"),p=>p.tabIndex!==-1);c!=null&&c.focus({preventScroll:!0})})}et(at,{bindComponent(c){l.push(c)},unbindComponent(c){const p=l.indexOf(c);p!==-1&&l.splice(p,1)}});let g=!1;return qe(()=>{g=!0}),Ce(()=>{g===!0&&e.autofocus===!0&&h()}),ne(()=>{e.autofocus===!0&&h()}),Object.assign(b.proxy,{validate:a,resetValidation:s,submit:u,reset:y,focus:h,getValidationComponents:()=>l}),()=>z("form",{class:"q-form",ref:t,onSubmit:u,onReset:y},we(r.default))}});const Ht=Y({__name:"ChatInput",emits:["sendMessage"],setup(e,{emit:r}){const n=C(""),b=r,t=()=>{b("sendMessage",n.value),n.value=""};return(o,l)=>(P(),F(Lt,{onSubmit:l[1]||(l[1]=ot(()=>{},["prevent"]))},{default:B(()=>[x(pt,{modelValue:n.value,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value=a),placeholder:"Type a message",color:"pink-5",dense:"",outlined:"",autogrow:""},{after:B(()=>[x(Be,{round:"",dense:"",flat:"",icon:"send",color:"pink-5",type:"submit",onClick:t})]),_:1},8,["modelValue"])]),_:1}))}});const Vt={key:0},jt={key:1,class:"chat-container q-pa-md"},Ft=Y({__name:"ChatPage",setup(e){var p;const n=(p=lt().params)==null?void 0:p.id,{room:b,fetchRoomData:t,updateLatestMessage:o}=it(n),{currentUser:l}=st(),a=C([]),s=C([]),u=C(!0),y=async()=>{if(b.users.length>0){const m=ce(Re,Ie(De(),"in",b.users)),d=await de(m);a.value=d.docs.map(S=>({id:S.id,displayName:S.data().displayName,photoURL:S.data().photoURL,rooms:S.data().rooms}))}},h=f(()=>s.value.map(m=>{const d=m.data,S=a.value.find(L=>L.id===d.author);return S?{id:m.id,data:{message:d.message,author:S,timestamp:d.timestamp}}:null}).filter(m=>m!==null)),g=async()=>{try{const m=ce(ve(n),Qe("timestamp","asc")),d=await de(m);s.value=d.docs.map(S=>({id:S.id,data:S.data()}))}catch(m){console.error("Failed to fetch messages",m)}finally{u.value=!1}},c=async m=>{var d;if(!!m.trim())try{const S=Le();await He(ve(n),{message:m,author:(d=l.value)==null?void 0:d.uid,timestamp:S}),await o(n,{text:m,timestamp:S}),await g()}catch(S){console.error("Failed to send message:",S)}};return ne(async()=>{await t(),await Promise.all([g(),y()])}),(m,d)=>xe(b).loading||u.value?(P(),R("div",Vt,[x(W,{type:"text",class:"q-mb-sm"}),x(W,{type:"text",class:"q-mb-sm"}),x(W,{type:"text"})])):(P(),R("div",jt,[x(Ht,{onSendMessage:c,style:{width:"inherit"}}),x(Qt,{class:"full-height",messages:h.value},null,8,["messages"])]))}});var ea=ke(Ft,[["__scopeId","data-v-5bd5bd10"]]);export{ea as default};
