import{k as kt,l as wt,b as _t,h as ee,Q as N,R as qt,m as xt,n as Ct,v as nt,o as Tt,p as se,q as Vt,e as St,c as Et,d as Rt,f as $t}from"./QBtn.3017b0bb.js";import{o as Ve,d as re,c as Se,a as X,q as Le,w as De,g as Pt,b as Ee,e as st,f as Bt,h as ze,u as Lt,i as Dt}from"./firebase.a8ab39df.js";import{Q as ue}from"./QAvatar.095d86d8.js";import{a as Me,b as Fe,c as Ne}from"./auth.5b5ad50b.js";import{l as Q,t as k,A as h,m as _,J as Ie,Q as ce,B as A,n as te,u as it,v as Qe,aa as Ae,H as Y,o as q,p as E,w as C,z as Mt,x as y,W as M,X as R,Y as qe,$ as Ue,Z as G,y as Re,ab as Ft,P as me,ac as je,ad as rt,a2 as de,a5 as Z,ae as Ke,af as It,ag as Qt,ah as P,U as L,ai as At,T as We,I as Ht,aj as z,ak as Ot}from"./index.5cdbdc63.js";import{Q as zt,r as Je,a as Nt,b as Ut,c as $e,u as jt,d as Kt}from"./QInput.94d16954.js";import{_ as Wt}from"./OverlappingAvatars.d66d942c.js";import{u as Jt,a as Xt}from"./room.b3cc457d.js";import{a as ut,Q as ct}from"./QCard.63db5039.js";import{b as Yt,a as Gt,h as Zt}from"./scroll.e732c370.js";var Pe=Q({name:"QItem",props:{...Me,...kt,tag:{type:String,default:"div"},active:{type:Boolean,default:null},clickable:Boolean,dense:Boolean,insetLevel:Number,tabindex:[String,Number],focused:Boolean,manualFocus:Boolean},emits:["click","keyup"],setup(e,{slots:o,emit:t}){const{proxy:{$q:l}}=A(),a=Fe(e,l),{hasLink:s,linkAttrs:r,linkClass:m,linkTag:u,navigateOnClick:d}=wt(),i=k(null),n=k(null),c=h(()=>e.clickable===!0||s.value===!0||e.tag==="label"),f=h(()=>e.disable!==!0&&c.value===!0),w=h(()=>"q-item q-item-type row no-wrap"+(e.dense===!0?" q-item--dense":"")+(a.value===!0?" q-item--dark":"")+(s.value===!0&&e.active===null?m.value:e.active===!0?` q-item--active${e.activeClass!==void 0?` ${e.activeClass}`:""}`:"")+(e.disable===!0?" disabled":"")+(f.value===!0?" q-item--clickable q-link cursor-pointer "+(e.manualFocus===!0?"q-manual-focusable":"q-focusable q-hoverable")+(e.focused===!0?" q-manual-focusable--focused":""):"")),V=h(()=>{if(e.insetLevel===void 0)return null;const b=l.lang.rtl===!0?"Right":"Left";return{["padding"+b]:16+e.insetLevel*56+"px"}});function T(b){f.value===!0&&(n.value!==null&&(b.qKeyEvent!==!0&&document.activeElement===i.value?n.value.focus():document.activeElement===n.value&&i.value.focus()),d(b))}function S(b){if(f.value===!0&&Ie(b,[13,32])===!0){ce(b),b.qKeyEvent=!0;const B=new MouseEvent("click",b);B.qKeyEvent=!0,i.value.dispatchEvent(B)}t("keyup",b)}function g(){const b=_t(o.default,[]);return f.value===!0&&b.unshift(_("div",{class:"q-focus-helper",tabindex:-1,ref:n})),b}return()=>{const b={ref:i,class:w.value,style:V.value,role:"listitem",onClick:T,onKeyup:S};return f.value===!0?(b.tabindex=e.tabindex||"0",Object.assign(b,r.value)):c.value===!0&&(b["aria-disabled"]="true"),_(u.value,b,g())}}}),Be=Q({name:"QItemSection",props:{avatar:Boolean,thumbnail:Boolean,side:Boolean,top:Boolean,noWrap:Boolean},setup(e,{slots:o}){const t=h(()=>`q-item__section column q-item__section--${e.avatar===!0||e.side===!0||e.thumbnail===!0?"side":"main"}`+(e.top===!0?" q-item__section--top justify-start":" justify-center")+(e.avatar===!0?" q-item__section--avatar":"")+(e.thumbnail===!0?" q-item__section--thumbnail":"")+(e.noWrap===!0?" q-item__section--nowrap":""));return()=>_("div",{class:t.value},ee(o.default))}});const eo=["ul","ol"];var to=Q({name:"QList",props:{...Me,bordered:Boolean,dense:Boolean,separator:Boolean,padding:Boolean,tag:{type:String,default:"div"}},setup(e,{slots:o}){const t=A(),l=Fe(e,t.proxy.$q),a=h(()=>eo.includes(e.tag)?null:"list"),s=h(()=>"q-list"+(e.bordered===!0?" q-list--bordered":"")+(e.dense===!0?" q-list--dense":"")+(e.separator===!0?" q-list--separator":"")+(l.value===!0?" q-list--dark":"")+(e.padding===!0?" q-list--padding":""));return()=>_(e.tag,{class:s.value,role:a.value},ee(o.default))}});const oo={key:0},lo={key:1},ao={class:"row items-center q-gutter-sm"},no={class:"text-weight-bold"},so={class:"text-caption text-grey"},io={class:"row items-center q-gutter-sm"},ro=te({__name:"ChatListItem",props:{id:{}},setup(e){const o=it(),t=e,{leaveRoom:l}=Jt(),a=k(!0),s=k();let r=null;const m=i=>{r=Ve(re(Se,i),n=>{var c;if(n.exists()){const f=n.data();s.value={name:f.name,users:f.users||[],private:(c=f.private)!=null?c:!0,latestMessage:f.latestMessageText&&f.latestMessageTimestamp?{text:f.latestMessageText,timestamp:f.latestMessageTimestamp}:void 0}}a.value=!1},n=>{console.error("Error fetching room:",n),a.value=!1})},u=i=>{const n=i.toDate();return n.toLocaleDateString()===new Date().toLocaleDateString()?n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):n.toLocaleString([],{hour:"2-digit",minute:"2-digit"})},d=async i=>{if(i.stopPropagation(),!!t.id)try{await l(t.id),o.currentRoute.value.params.id===t.id&&await o.push("/chats")}catch(n){console.error("Failed to leave room:",n)}};return Qe(()=>{m(t.id)}),Ae(()=>{r&&r()}),(i,n)=>Y((q(),E(Pe,{clickable:"",onClick:n[0]||(n[0]=c=>Mt(o).push(`/chat/${t.id}`))},{default:C(()=>[y(Be,null,{default:C(()=>{var c,f;return[a.value?(q(),M("div",oo,[y(ue,{type:"text",width:"100px"}),y(ue,{type:"text",width:"50px"})])):(q(),M("div",lo,[R("div",ao,[R("div",no,qe((c=s.value)==null?void 0:c.name),1),s.value&&!s.value.private?(q(),E(zt,{key:0,dense:"",size:"sm",color:"pink-5","text-color":"white",label:"Public"})):Ue("",!0)]),R("div",so,[(f=s.value)!=null&&f.latestMessage?(q(),M(G,{key:0},[Re(qe(s.value.latestMessage.text)+" \xB7 "+qe(u(s.value.latestMessage.timestamp)),1)],64)):(q(),M(G,{key:1},[Re("No messages yet")],64))])]))]}),_:1}),y(Be,{side:""},{default:C(()=>{var c,f;return[R("div",io,[(f=(c=s.value)==null?void 0:c.users)!=null&&f.length?(q(),E(Wt,{key:0,users:s.value.users,right:""},null,8,["users"])):Ue("",!0),y(N,{icon:"logout",flat:"",round:"",onClick:d,color:"negative"})])]}),_:1})]),_:1})),[[qt]])}}),uo={class:"col"},co=te({__name:"ChatList",setup(e){const o=k(!0),t=k([]),l=k([]);let a=null,s=null;const r=async()=>{var d;!((d=Ne.value)!=null&&d.uid)||(a=Ve(re(X,"users",Ne.value.uid),async i=>{var f;const n=((f=i.data())==null?void 0:f.rooms)||[],c=await Promise.all(n.map(async w=>{var S;const T=(await Pt(re(Se,w))).data();return{id:w,lastMessageTime:((S=T==null?void 0:T.lastMessageTime)==null?void 0:S.toMillis())||0}}));t.value=c,o.value=!1}))},m=()=>{const d=Le(Se,De("private","==",!1));s=Ve(d,async i=>{const n=i.docs.map(c=>{var f;return{id:c.id,lastMessageTime:((f=c.data().lastMessageTime)==null?void 0:f.toMillis())||0}});l.value=n})},u=h(()=>{const d=new Set(t.value.map(n=>n.id)),i=l.value.filter(n=>!d.has(n.id));return[...t.value,...i].sort((n,c)=>c.lastMessageTime-n.lastMessageTime)});return Qe(async()=>{await r(),m()}),Ae(()=>{a==null||a(),s==null||s()}),(d,i)=>(q(),E(to,{bordered:"",separator:""},{default:C(()=>[o.value?(q(),E(Pe,{key:0},{default:C(()=>[R("div",uo,[y(ue,{type:"rect",width:"250px"}),y(ue,{type:"text",width:"200px"})])]),_:1})):(q(),M(G,{key:1},[u.value.length===0?(q(),E(Pe,{key:0},{default:C(()=>[y(Be,null,{default:C(()=>i[0]||(i[0]=[Re("No chatrooms available.")])),_:1})]),_:1})):(q(!0),M(G,{key:1},Ft(u.value,n=>(q(),E(ro,{key:n.id,id:n.id},null,8,["id"]))),128))],64))]),_:1}))}});var dt=Q({name:"QCardActions",props:{...xt,vertical:Boolean},setup(e,{slots:o}){const t=Ct(e),l=h(()=>`q-card__actions ${t.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>_("div",{class:l.value},ee(o.default))}});function fo(e,o,t){let l;function a(){l!==void 0&&(je.remove(l),l=void 0)}return me(()=>{e.value===!0&&a()}),{removeFromHistory:a,addToHistory(){l={condition:()=>t.value===!0,handler:o},je.add(l)}}}function mo(){let e=null;const o=A();function t(){e!==null&&(clearTimeout(e),e=null)}return rt(t),me(t),{removeTimeout:t,registerTimeout(l,a){t(),nt(o)===!1&&(e=setTimeout(()=>{e=null,l()},a))}}}function vo(){let e;const o=A();function t(){e=void 0}return rt(t),me(t),{removeTick:t,registerTick(l){e=l,de(()=>{e===l&&(nt(o)===!1&&e(),e=void 0)})}}}const go={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},po=["beforeShow","show","beforeHide","hide"];function ho({showing:e,canShow:o,hideOnRouteChange:t,handleShow:l,handleHide:a,processOnMount:s}){const r=A(),{props:m,emit:u,proxy:d}=r;let i;function n(g){e.value===!0?w(g):c(g)}function c(g){if(m.disable===!0||g!==void 0&&g.qAnchorHandled===!0||o!==void 0&&o(g)!==!0)return;const b=m["onUpdate:modelValue"]!==void 0;b===!0&&(u("update:modelValue",!0),i=g,de(()=>{i===g&&(i=void 0)})),(m.modelValue===null||b===!1)&&f(g)}function f(g){e.value!==!0&&(e.value=!0,u("beforeShow",g),l!==void 0?l(g):u("show",g))}function w(g){if(m.disable===!0)return;const b=m["onUpdate:modelValue"]!==void 0;b===!0&&(u("update:modelValue",!1),i=g,de(()=>{i===g&&(i=void 0)})),(m.modelValue===null||b===!1)&&V(g)}function V(g){e.value!==!1&&(e.value=!1,u("beforeHide",g),a!==void 0?a(g):u("hide",g))}function T(g){m.disable===!0&&g===!0?m["onUpdate:modelValue"]!==void 0&&u("update:modelValue",!1):g===!0!==e.value&&(g===!0?f:V)(i)}Z(()=>m.modelValue,T),t!==void 0&&Tt(r)===!0&&Z(()=>d.$route.fullPath,()=>{t.value===!0&&e.value===!0&&w()}),s===!0&&Qe(()=>{T(m.modelValue)});const S={show:c,hide:w,toggle:n};return Object.assign(d,S),S}const bo={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function yo(e,o=()=>{},t=()=>{}){return{transitionProps:h(()=>{const l=`q-transition--${e.transitionShow||o()}`,a=`q-transition--${e.transitionHide||t()}`;return{appear:!0,enterFromClass:`${l}-enter-from`,enterActiveClass:`${l}-enter-active`,enterToClass:`${l}-enter-to`,leaveFromClass:`${a}-leave-from`,leaveActiveClass:`${a}-leave-active`,leaveToClass:`${a}-leave-to`}}),transitionStyle:h(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}let ko=1,wo=document.body;function _o(e,o){const t=document.createElement("div");if(t.id=o!==void 0?`q-portal--${o}--${ko++}`:e,Ke.globalNodes!==void 0){const l=Ke.globalNodes.class;l!==void 0&&(t.className=l)}return wo.appendChild(t),t}function qo(e){e.remove()}const ie=[];function xo(e){return ie.find(o=>o.contentEl!==null&&o.contentEl.contains(e))}function Co(e,o){do{if(e.$options.name==="QMenu"){if(e.hide(o),e.$props.separateClosePopup===!0)return se(e)}else if(e.__qPortal===!0){const t=se(e);return t!==void 0&&t.$options.name==="QPopupProxy"?(e.hide(o),t):e}e=se(e)}while(e!=null)}function To(e,o,t){for(;t!==0&&e!==void 0&&e!==null;){if(e.__qPortal===!0){if(t--,e.$options.name==="QMenu"){e=Co(e,o);continue}e.hide(o)}e=se(e)}}const Vo=Q({name:"QPortal",setup(e,{slots:o}){return()=>o.default()}});function So(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function Eo(e,o,t,l){const a=k(!1),s=k(!1);let r=null;const m={},u=l==="dialog"&&So(e);function d(n){if(n===!0){Je(m),s.value=!0;return}s.value=!1,a.value===!1&&(u===!1&&r===null&&(r=_o(!1,l)),a.value=!0,ie.push(e.proxy),Nt(m))}function i(n){if(s.value=!1,n!==!0)return;Je(m),a.value=!1;const c=ie.indexOf(e.proxy);c!==-1&&ie.splice(c,1),r!==null&&(qo(r),r=null)}return Ae(()=>{i(!0)}),e.proxy.__qPortal=!0,It(e.proxy,"contentEl",()=>o.value),{showPortal:d,hidePortal:i,portalIsActive:a,portalIsAccessible:s,renderPortal:()=>u===!0?t():a.value===!0?[_(Qt,{to:r},_(Vo,t))]:void 0}}let W=0,xe,Ce,J,Te=!1,Xe,Ye,Ge,D=null;function Ro(e){$o(e)&&ce(e)}function $o(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const o=At(e),t=e.shiftKey&&!e.deltaX,l=!t&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),a=t||l?e.deltaY:e.deltaX;for(let s=0;s<o.length;s++){const r=o[s];if(Zt(r,l))return l?a<0&&r.scrollTop===0?!0:a>0&&r.scrollTop+r.clientHeight===r.scrollHeight:a<0&&r.scrollLeft===0?!0:a>0&&r.scrollLeft+r.clientWidth===r.scrollWidth}return!0}function Ze(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function ae(e){Te!==!0&&(Te=!0,requestAnimationFrame(()=>{Te=!1;const{height:o}=e.target,{clientHeight:t,scrollTop:l}=document.scrollingElement;(J===void 0||o!==window.innerHeight)&&(J=t-o,document.scrollingElement.scrollTop=l),l>J&&(document.scrollingElement.scrollTop-=Math.ceil((l-J)/8))}))}function et(e){const o=document.body,t=window.visualViewport!==void 0;if(e==="add"){const{overflowY:l,overflowX:a}=window.getComputedStyle(o);xe=Yt(window),Ce=Gt(window),Xe=o.style.left,Ye=o.style.top,Ge=window.location.href,o.style.left=`-${xe}px`,o.style.top=`-${Ce}px`,a!=="hidden"&&(a==="scroll"||o.scrollWidth>window.innerWidth)&&o.classList.add("q-body--force-scrollbar-x"),l!=="hidden"&&(l==="scroll"||o.scrollHeight>window.innerHeight)&&o.classList.add("q-body--force-scrollbar-y"),o.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,P.is.ios===!0&&(t===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",ae,L.passiveCapture),window.visualViewport.addEventListener("scroll",ae,L.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",Ze,L.passiveCapture))}P.is.desktop===!0&&P.is.mac===!0&&window[`${e}EventListener`]("wheel",Ro,L.notPassive),e==="remove"&&(P.is.ios===!0&&(t===!0?(window.visualViewport.removeEventListener("resize",ae,L.passiveCapture),window.visualViewport.removeEventListener("scroll",ae,L.passiveCapture)):window.removeEventListener("scroll",Ze,L.passiveCapture)),o.classList.remove("q-body--prevent-scroll"),o.classList.remove("q-body--force-scrollbar-x"),o.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,o.style.left=Xe,o.style.top=Ye,window.location.href===Ge&&window.scrollTo(xe,Ce),J=void 0)}function Po(e){let o="add";if(e===!0){if(W++,D!==null){clearTimeout(D),D=null;return}if(W>1)return}else{if(W===0||(W--,W>0))return;if(o="remove",P.is.ios===!0&&P.is.nativeMobile===!0){D!==null&&clearTimeout(D),D=setTimeout(()=>{et(o),D=null},100);return}}et(o)}function Bo(){let e;return{preventBodyScroll(o){o!==e&&(e!==void 0||o===!0)&&(e=o,Po(o))}}}const F=[];let U;function Lo(e){U=e.keyCode===27}function Do(){U===!0&&(U=!1)}function Mo(e){U===!0&&(U=!1,Ie(e,27)===!0&&F[F.length-1](e))}function ft(e){window[e]("keydown",Lo),window[e]("blur",Do),window[e]("keyup",Mo),U=!1}function Fo(e){P.is.desktop===!0&&(F.push(e),F.length===1&&ft("addEventListener"))}function tt(e){const o=F.indexOf(e);o!==-1&&(F.splice(o,1),F.length===0&&ft("removeEventListener"))}const I=[];function mt(e){I[I.length-1](e)}function Io(e){P.is.desktop===!0&&(I.push(e),I.length===1&&document.body.addEventListener("focusin",mt))}function ot(e){const o=I.indexOf(e);o!==-1&&(I.splice(o,1),I.length===0&&document.body.removeEventListener("focusin",mt))}let ne=0;const Qo={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},lt={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]};var vt=Q({name:"QDialog",inheritAttrs:!1,props:{...go,...bo,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,backdropFilter:String,position:{type:String,default:"standard",validator:e=>["standard","top","bottom","left","right"].includes(e)}},emits:[...po,"shake","click","escapeKey"],setup(e,{slots:o,emit:t,attrs:l}){const a=A(),s=k(null),r=k(!1),m=k(!1);let u=null,d=null,i,n;const c=h(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:f}=Bo(),{registerTimeout:w}=mo(),{registerTick:V,removeTick:T}=vo(),{transitionProps:S,transitionStyle:g}=yo(e,()=>lt[e.position][0],()=>lt[e.position][1]),b=h(()=>g.value+(e.backdropFilter!==void 0?`;backdrop-filter:${e.backdropFilter};-webkit-backdrop-filter:${e.backdropFilter}`:"")),{showPortal:B,hidePortal:oe,portalIsAccessible:ve,renderPortal:j}=Eo(a,s,yt,"dialog"),{hide:H}=ho({showing:r,hideOnRouteChange:c,handleShow:gt,handleHide:pt,processOnMount:!0}),{addToHistory:ge,removeFromHistory:pe}=fo(r,H,c),he=h(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${Qo[e.position]}`+(m.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),v=h(()=>r.value===!0&&e.seamless!==!0),$=h(()=>e.autoClose===!0?{onClick:ht}:{}),le=h(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${v.value===!0?"modal":"seamless"}`,l.class]);Z(()=>e.maximized,p=>{r.value===!0&&ke(p)}),Z(v,p=>{f(p),p===!0?(Io(we),Fo(ye)):(ot(we),tt(ye))});function gt(p){ge(),d=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,ke(e.maximized),B(),m.value=!0,e.noFocus!==!0?(document.activeElement!==null&&document.activeElement.blur(),V(K)):T(),w(()=>{if(a.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:x,bottom:O}=document.activeElement.getBoundingClientRect(),{innerHeight:Oe}=window,_e=window.visualViewport!==void 0?window.visualViewport.height:Oe;x>0&&O>_e/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-_e,O>=Oe?1/0:Math.ceil(document.scrollingElement.scrollTop+O-_e/2))),document.activeElement.scrollIntoView()}n=!0,s.value.click(),n=!1}B(!0),m.value=!1,t("show",p)},e.transitionDuration)}function pt(p){T(),pe(),He(!0),m.value=!0,oe(),d!==null&&(((p&&p.type.indexOf("key")===0?d.closest('[tabindex]:not([tabindex^="-"])'):void 0)||d).focus(),d=null),w(()=>{oe(!0),m.value=!1,t("hide",p)},e.transitionDuration)}function K(p){Ut(()=>{let x=s.value;if(x!==null){if(p!==void 0){const O=x.querySelector(p);if(O!==null){O.focus({preventScroll:!0});return}}x.contains(document.activeElement)!==!0&&(x=x.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||x.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||x.querySelector("[autofocus], [data-autofocus]")||x,x.focus({preventScroll:!0}))}})}function be(p){p&&typeof p.focus=="function"?p.focus({preventScroll:!0}):K(),t("shake");const x=s.value;x!==null&&(x.classList.remove("q-animate--scale"),x.classList.add("q-animate--scale"),u!==null&&clearTimeout(u),u=setTimeout(()=>{u=null,s.value!==null&&(x.classList.remove("q-animate--scale"),K())},170))}function ye(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&be():(t("escapeKey"),H()))}function He(p){u!==null&&(clearTimeout(u),u=null),(p===!0||r.value===!0)&&(ke(!1),e.seamless!==!0&&(f(!1),ot(we),tt(ye))),p!==!0&&(d=null)}function ke(p){p===!0?i!==!0&&(ne<1&&document.body.classList.add("q-body--dialog"),ne++,i=!0):i===!0&&(ne<2&&document.body.classList.remove("q-body--dialog"),ne--,i=!1)}function ht(p){n!==!0&&(H(p),t("click",p))}function bt(p){e.persistent!==!0&&e.noBackdropDismiss!==!0?H(p):e.noShake!==!0&&be()}function we(p){e.allowFocusOutside!==!0&&ve.value===!0&&Vt(s.value,p.target)!==!0&&K('[tabindex]:not([tabindex="-1"])')}Object.assign(a.proxy,{focus:K,shake:be,__updateRefocusTarget(p){d=p||null}}),me(He);function yt(){return _("div",{role:"dialog","aria-modal":v.value===!0?"true":"false",...l,class:le.value},[_(We,{name:"q-transition--fade",appear:!0},()=>v.value===!0?_("div",{class:"q-dialog__backdrop fixed-full",style:b.value,"aria-hidden":"true",tabindex:-1,onClick:bt}):null),_(We,S.value,()=>r.value===!0?_("div",{ref:s,class:he.value,style:g.value,tabindex:-1,...$.value},ee(o.default)):null)])}return j}});function at(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const o=parseInt(e,10);return isNaN(o)?0:o}var fe=Ht({name:"close-popup",beforeMount(e,{value:o}){const t={depth:at(o),handler(l){t.depth!==0&&setTimeout(()=>{const a=xo(e);a!==void 0&&To(a,l,t.depth)})},handlerKey(l){Ie(l,13)===!0&&t.handler(l)}};e.__qclosepopup=t,e.addEventListener("click",t.handler),e.addEventListener("keyup",t.handlerKey)},updated(e,{value:o,oldValue:t}){o!==t&&(e.__qclosepopup.depth=at(o))},beforeUnmount(e){const o=e.__qclosepopup;e.removeEventListener("click",o.handler),e.removeEventListener("keyup",o.handlerKey),delete e.__qclosepopup}});const Ao=te({__name:"JoinRoomDialog",emits:["createRoom","joinRoom"],setup(e,{emit:o}){const t=o,l=k(!1),a=k(""),s=k(!1),r=k(!1),m=async i=>{if(!i){s.value=!1;return}r.value=!0;try{const n=Le(Ee(X,"chatrooms"),De("code","==",i)),c=await st(n);s.value=!c.empty}catch(n){console.error("Failed to check room:",n),s.value=!1}finally{r.value=!1}};let u;const d=()=>{s.value?t("joinRoom",a.value):t("createRoom",a.value)};return Z(a,i=>{clearTimeout(u),u=setTimeout(()=>{m(i)},500)}),(i,n)=>(q(),E(vt,{modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=c=>l.value=c)},{default:C(()=>[y(ct,null,{default:C(()=>[y(ut,{class:"q-gutter-md"},{default:C(()=>[n[2]||(n[2]=R("div",{class:"text-h6"},"Join Room",-1)),y($e,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=c=>a.value=c),label:"Room Code",outlined:"","stack-label":"",hint:!s.value&&a.value?"Room does not exist":""},null,8,["modelValue","hint"])]),_:1}),y(dt,{align:"right"},{default:C(()=>[Y(y(N,{flat:"",label:"Cancel"},null,512),[[fe]]),Y(y(N,{flat:"",label:s.value?"JOIN":"CREATE ROOM",onClick:d},null,8,["label"]),[[fe]])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}});function Ho(e,o){const t=k(null),l=h(()=>e.disable===!0?null:_("span",{ref:t,class:"no-outline",tabindex:-1}));function a(s){const r=o.value;s!==void 0&&s.type.indexOf("key")===0?r!==null&&document.activeElement!==r&&r.contains(document.activeElement)===!0&&r.focus():t.value!==null&&(s===void 0||r!==null&&r.contains(s.target)===!0)&&t.value.focus()}return{refocusTargetEl:l,refocusTarget:a}}var Oo={xs:30,sm:35,md:40,lg:50,xl:60};const zo={...Me,...Rt,...jt,modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},checkedIcon:String,uncheckedIcon:String,indeterminateIcon:String,toggleOrder:{type:String,validator:e=>e==="tf"||e==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]},No=["update:modelValue"];function Uo(e,o){const{props:t,slots:l,emit:a,proxy:s}=A(),{$q:r}=s,m=Fe(t,r),u=k(null),{refocusTargetEl:d,refocusTarget:i}=Ho(t,u),n=St(t,Oo),c=h(()=>t.val!==void 0&&Array.isArray(t.modelValue)),f=h(()=>{const v=z(t.val);return c.value===!0?t.modelValue.findIndex($=>z($)===v):-1}),w=h(()=>c.value===!0?f.value!==-1:z(t.modelValue)===z(t.trueValue)),V=h(()=>c.value===!0?f.value===-1:z(t.modelValue)===z(t.falseValue)),T=h(()=>w.value===!1&&V.value===!1),S=h(()=>t.disable===!0?-1:t.tabindex||0),g=h(()=>`q-${e} cursor-pointer no-outline row inline no-wrap items-center`+(t.disable===!0?" disabled":"")+(m.value===!0?` q-${e}--dark`:"")+(t.dense===!0?` q-${e}--dense`:"")+(t.leftLabel===!0?" reverse":"")),b=h(()=>{const v=w.value===!0?"truthy":V.value===!0?"falsy":"indet",$=t.color!==void 0&&(t.keepColor===!0||(e==="toggle"?w.value===!0:V.value!==!0))?` text-${t.color}`:"";return`q-${e}__inner relative-position non-selectable q-${e}__inner--${v}${$}`}),B=h(()=>{const v={type:"checkbox"};return t.name!==void 0&&Object.assign(v,{".checked":w.value,"^checked":w.value===!0?"checked":void 0,name:t.name,value:c.value===!0?t.val:t.trueValue}),v}),oe=Kt(B),ve=h(()=>{const v={tabindex:S.value,role:e==="toggle"?"switch":"checkbox","aria-label":t.label,"aria-checked":T.value===!0?"mixed":w.value===!0?"true":"false"};return t.disable===!0&&(v["aria-disabled"]="true"),v});function j(v){v!==void 0&&(ce(v),i(v)),t.disable!==!0&&a("update:modelValue",H(),v)}function H(){if(c.value===!0){if(w.value===!0){const v=t.modelValue.slice();return v.splice(f.value,1),v}return t.modelValue.concat([t.val])}if(w.value===!0){if(t.toggleOrder!=="ft"||t.toggleIndeterminate===!1)return t.falseValue}else if(V.value===!0){if(t.toggleOrder==="ft"||t.toggleIndeterminate===!1)return t.trueValue}else return t.toggleOrder!=="ft"?t.trueValue:t.falseValue;return t.indeterminateValue}function ge(v){(v.keyCode===13||v.keyCode===32)&&ce(v)}function pe(v){(v.keyCode===13||v.keyCode===32)&&j(v)}const he=o(w,T);return Object.assign(s,{toggle:j}),()=>{const v=he();t.disable!==!0&&oe(v,"unshift",` q-${e}__native absolute q-ma-none q-pa-none`);const $=[_("div",{class:b.value,style:n.value,"aria-hidden":"true"},v)];d.value!==null&&$.push(d.value);const le=t.label!==void 0?Et(l.default,[t.label]):ee(l.default);return le!==void 0&&$.push(_("div",{class:`q-${e}__label q-anchor--skip`},le)),_("div",{ref:u,class:g.value,...ve.value,onClick:j,onKeydown:ge,onKeyup:pe},$)}}var jo=Q({name:"QToggle",props:{...zo,icon:String,iconColor:String},emits:No,setup(e){function o(t,l){const a=h(()=>(t.value===!0?e.checkedIcon:l.value===!0?e.indeterminateIcon:e.uncheckedIcon)||e.icon),s=h(()=>t.value===!0?e.iconColor:null);return()=>[_("div",{class:"q-toggle__track"}),_("div",{class:"q-toggle__thumb absolute flex flex-center no-wrap"},a.value!==void 0?[_($t,{name:a.value,color:s.value})]:void 0)]}return Uo("toggle",o)}});const Ko=te({__name:"CreateRoomDialog",emits:["update:roomCode","createRoom"],setup(e,{emit:o}){const t=k(""),l=k(""),a=k(!1),s=k(!1),r=o;return(m,u)=>(q(),E(vt,{modelValue:s.value,"onUpdate:modelValue":u[5]||(u[5]=d=>s.value=d)},{default:C(()=>[y(ct,null,{default:C(()=>[y(ut,{class:"q-gutter-md"},{default:C(()=>[u[6]||(u[6]=R("div",{class:"text-h6"},"Create Room",-1)),y($e,{modelValue:t.value,"onUpdate:modelValue":[u[0]||(u[0]=d=>t.value=d),u[1]||(u[1]=d=>m.$emit("update:roomCode",d))],label:"Room Code","stack-label":""},null,8,["modelValue"]),y($e,{modelValue:l.value,"onUpdate:modelValue":u[2]||(u[2]=d=>l.value=d),label:"Room Name","stack-label":""},null,8,["modelValue"]),y(jo,{modelValue:a.value,"onUpdate:modelValue":u[3]||(u[3]=d=>a.value=d),label:"Private Room"},null,8,["modelValue"])]),_:1}),y(dt,{align:"right"},{default:C(()=>[Y(y(N,{flat:"",label:"Cancel"},null,512),[[fe]]),Y(y(N,{flat:"",label:"Create",onClick:u[4]||(u[4]=d=>r("createRoom",t.value,l.value,a.value))},null,512),[[fe]])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Wo={class:"q-pa-md q-gutter-md"},Jo={class:"flex justify-between items-center"},sl=te({__name:"ChatsPage",setup(e){const{currentUser:o}=Xt(),t=k(!1),l=k(!1),a=k(""),s=it(),r=async d=>{try{const i=Le(Ee(X,"chatrooms"),De("code","==",d)),n=await st(i);if(!n.empty){const c=n.docs[0].id;await s.push(`/chat/${c}`)}}catch(i){console.error("Failed to join room:",i)}},m=d=>{a.value=d,t.value=!1,de(()=>{l.value=!0})},u=async(d,i,n)=>{if(!!o.value)try{const c=await Bt(Ee(X,"chatrooms"),{code:d,name:i,private:n,users:[o.value.uid],createdAt:ze(),lastMessageTime:ze()});await Lt(re(X,"users",o.value.uid),{rooms:Dt(c.id)}),l.value=!1,await s.push(`/chat/${c.id}`)}catch(c){console.error("Failed to create room:",c)}};return(d,i)=>(q(),M(G,null,[R("div",Wo,[R("div",Jo,[i[3]||(i[3]=R("div",{class:"text-h4 text-weight-bold"},"Chats",-1)),y(N,{icon:"add",color:"pink-5",size:"sm",round:"",onClick:i[0]||(i[0]=n=>t.value=!0)})]),(q(),E(Ot,null,{default:C(()=>[y(co)]),_:1}))]),y(Ao,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=n=>t.value=n),onJoinRoom:r,onCreateRoom:m},null,8,["modelValue"]),y(Ko,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=n=>l.value=n),"room-code":a.value,onCreateRoom:u},null,8,["modelValue","room-code"])],64))}});export{sl as default};
